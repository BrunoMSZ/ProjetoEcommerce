<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Loja - Início</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles.css') }}">
</head>
<body>
    <header>
        <div class="container">
            <h1>SonicPads</h1>
            <nav>
                <ul>
                    <li><a href="/">Início</a></li>
                    <li><a href="/contact">Contato</a></li>
                    <li><a href="carrinho">Carrinho (<span id="cart-count">0</span>)</a></li>
                    <li id="login-area">
                        <button class="login-button" onclick="toggleLoginForm()">Login</button>
                        <a href="/conta" id="account-link" style="display: none;">Minha Conta</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    
    <main>
        <div class="container" id="inicio">
            <section class="products" id="product-list">
                <!-- Os produtos serão adicionados aqui via JavaScript -->
            </section>
        </div>
    </main>

    <!-- Formulário de Login -->
    <div class="login-form" id="loginForm">
        <div class="login-form-content">
            <h2>Login</h2>
            <form action="/login" method="post" onsubmit="handleLogin(event)">
                <label for="email">E-mail:</label>
                <input type="email" id="email" name="email" required>
                
                <label for="senha">Senha:</label>
                <input type="password" id="senha" name="senha" required>
                
                <button type="submit">Entrar</button>
            </form>
            <button class="close" onclick="toggleLoginForm()">Fechar</button>
        </div>
    </div>

    <script>
        let cartCount = 0;
        const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];

        function toggleLoginForm() {
            var loginForm = document.getElementById('loginForm');
            if (loginForm.style.display === 'flex') {
                loginForm.style.display = 'none';
            } else {
                loginForm.style.display = 'flex';
            }
        }

        function handleLogin(event) {
            event.preventDefault(); // Evita o envio do formulário para processar manualmente
            // Aqui você deve adicionar a lógica de autenticação e redirecionamento

            // Simulação de login bem-sucedido
            document.querySelector('.login-button').style.display = 'none'; // Oculta o botão de login
            document.getElementById('account-link').style.display = 'inline'; // Exibe o link "Minha Conta"
            toggleLoginForm(); // Fecha o formulário de login
        }

        function addToCart(name, price) {
            cartCount++;
            document.getElementById('cart-count').innerText = cartCount;

            // Adiciona o item ao localStorage
            cartItems.push({ name, price });
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
        }

        // Atualiza a contagem de itens no carrinho ao carregar a página
        document.getElementById('cart-count').innerText = cartItems.length;
        async function fetchProducts() {
            try {
                const response = await fetch('/');
                const produtos = await response.json();
                const productList = document.getElementById('product-list');
                productList.innerHTML = ''; // Limpa a lista atual de produtos
    
                produtos.forEach(produto => {
                    const productItem = document.createElement('article');
                    productItem.className = 'product';
                    productItem.innerHTML = `
                        <img src="${produto.imagem_url}" alt="${produto.nome}">
                        <h2>${produto.nome}</h2>
                        <p>${produto.descricao}</p>
                        <p class="price">R$ ${produto.preco.toFixed(2)}</p>
                        <button class="add-to-cart" onclick="addToCart('${produto.nome}', ${produto.preco})">Adicionar ao Carrinho</button>
                    `;
                    productList.appendChild(productItem);
                });
            } catch (error) {
                console.error('Erro ao buscar produtos:', error);
            }
        }
    
        // Chama a função para buscar os produtos quando a página carregar
        document.addEventListener('DOMContentLoaded', fetchProducts);
    </script>
</body>
</html>
